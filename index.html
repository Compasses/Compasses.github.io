<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.2"/>


    <meta name="description" content="杂乱 并蓄" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.2" />




  <title> 三十重围 </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">三十重围</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/10/23/golang-interface-analysis-by-gdb/">
                golang interface analysis by gdb
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-10-23
        </span>

        

        
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>interface 在go语言中，是非常重要的一环，总有点让人感到很玄乎不定的感觉。官方的lib中有大量使用，似乎面向对象和动态绑定也能跟interface扯上关系。总之，如果能更好的理解interface的机理，就能更好的理解和使用Go了。</p>
<p>interface的较为深层次的探讨在<a href="http://research.swtch.com/interfaces" target="_blank" rel="external">这篇blog</a>里面已经有较为详细的介绍。但是缺乏一些实践，本文遍结合此文，使用GDB实际研究一下。</p>
<h2 id="interface_内部存储">interface 内部存储</h2><p>interface的值，其实是两个指针的组合：data 和 tab。data 实际指向值的指针，tab是go runtime的一个struct：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layout of Itab known to compilers</span></span><br><span class="line"><span class="comment">// allocated in non-garbage-collected memory</span></span><br><span class="line">type itab struct &#123;</span><br><span class="line">    inter  *interfacetype</span><br><span class="line"></span><br><span class="line">    _type  *_type</span><br><span class="line"></span><br><span class="line">    link   *itab</span><br><span class="line"></span><br><span class="line">    bad    int32</span><br><span class="line">    unused int32</span><br><span class="line">    <span class="function"><span class="keyword">fun</span>    [1]uintptr <span class="comment">// variable sized</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在运行时该结构会被runtime库计算出来，保证interface的正常运转。<br>使用<strong>go build -gcflags “-N -l”</strong>编译便可以是用GDB来debug了。<br>断点断在最后一行代码，代码在最后列出。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info locals</span><br><span class="line"><span class="variable">b =</span> <span class="number">200</span></span><br><span class="line"><span class="variable">s =</span> &#123;<span class="variable">tab =</span> <span class="number">0</span>x7ffff7e0f1c0, <span class="variable">data =</span> <span class="number">0</span>xc82000a3b0&#125;</span><br><span class="line"><span class="variable">nothing =</span> &#123;<span class="variable">_type =</span> <span class="number">0</span>x4c1360, <span class="variable">data =</span> <span class="number">0</span>xc82000a430&#125;</span><br><span class="line"><span class="variable">face =</span> &#123;<span class="variable">tab =</span> <span class="number">0</span>x0, <span class="variable">data =</span> <span class="number">0</span>x0&#125;</span><br><span class="line"><span class="variable">any =</span> &#123;<span class="variable">_type =</span> <span class="number">0</span>x4e4a80, <span class="variable">data =</span> <span class="number">0</span>xc82000a3c0&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先看变量<em>s</em>，内部有个tab指针和data指针。<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p  *s.tab</span><br><span class="line">$<span class="number">24</span> = &#123;inter = <span class="number">0x4dffa0</span>, _type = <span class="number">0x4e4a80</span>, link = <span class="number">0x0</span>, bad = <span class="number">0</span>, unused = <span class="number">0</span>, <span class="function"><span class="keyword">fun</span> = &#123;4200784&#125;&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>结构就是上面的itab的数据结构，其中的interfacetype 和 _type的结构分别为：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> interfacetype <span class="keyword">struct</span> &#123;</span><br><span class="line">    typ  _type</span><br><span class="line"></span><br><span class="line">    mhdr []imethod</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Needs to be in sync with ../cmd/internal/ld/decodesym.go:/^func.commonsize,</span></span><br><span class="line"><span class="comment">// ../cmd/internal/gc/reflect.go:/^func.dcommontype and</span></span><br><span class="line"><span class="comment">// ../reflect/type.go:/^type.rtype.</span></span><br><span class="line"><span class="keyword">type</span> _type <span class="keyword">struct</span> &#123;</span><br><span class="line">    size       <span class="typename">uintptr</span></span><br><span class="line">    ptrdata    <span class="typename">uintptr</span> <span class="comment">// size of memory prefix holding all pointers</span></span><br><span class="line">    hash       <span class="typename">uint32</span></span><br><span class="line">    _unused    <span class="typename">uint8</span></span><br><span class="line">    align      <span class="typename">uint8</span></span><br><span class="line">    fieldalign <span class="typename">uint8</span></span><br><span class="line">    kind       <span class="typename">uint8</span></span><br><span class="line">    alg        *typeAlg</span><br><span class="line"></span><br><span class="line">    <span class="comment">// gcdata stores the GC type data for the garbage collector.</span></span><br><span class="line">    <span class="comment">// If the KindGCProg bit is set in kind, gcdata is a GC program.</span></span><br><span class="line">    <span class="comment">// Otherwise it is a ptrmask bitmap. See mbitmap.go for details.</span></span><br><span class="line">    gcdata  *<span class="typename">byte</span></span><br><span class="line">    _string *<span class="typename">string</span></span><br><span class="line">    x       *uncommontype</span><br><span class="line"></span><br><span class="line">    ptrto   *_type</span><br><span class="line"></span><br><span class="line">    zero    *<span class="typename">byte</span> <span class="comment">// ptr to the zero value for this type</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>分别看下里面的内容：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p  *s.tab.inter</span><br><span class="line">$<span class="number">26</span> = &#123;<span class="variable">typ =</span> &#123;<span class="variable">size =</span> <span class="number">16</span>, <span class="variable">ptrdata =</span> <span class="number">16</span>, <span class="variable">hash =</span> <span class="number">3958674519</span>, <span class="variable">_unused =</span> <span class="number">0</span> '\<span class="number">000</span>', <span class="variable">align =</span> <span class="number">8</span> '\b', <span class="variable">fieldalign =</span> <span class="number">8</span> '\b', <span class="variable">kind =</span> <span class="number">20</span> '\<span class="number">024</span>', <span class="variable">alg =</span> <span class="number">0</span>x592770 &lt;runtime.algarray+<span class="number">240</span>&gt;,</span><br><span class="line">    <span class="variable">gcdata =</span> <span class="number">0</span>x537142 <span class="string">"\003\004\005\006\a\b\t\n\r\016\017\020\021\022\025\026\031\032\033\037,568&gt;?Ur\236\237\325\365\377"</span>, <span class="variable">_string =</span> <span class="number">0</span>x5161d0, <span class="variable">x =</span> <span class="number">0</span>x4e0018, <span class="variable">ptrto =</span> <span class="number">0</span>x4b6e80,</span><br><span class="line">    <span class="variable">zero =</span> <span class="number">0</span>x539c40 &lt;runtime.zerovalue&gt; <span class="string">""</span>&#125;, <span class="variable">mhdr =</span> &#123;<span class="variable">array =</span> <span class="number">0</span>x4e0000, <span class="variable">len =</span> <span class="number">1</span>, <span class="variable">cap =</span> <span class="number">1</span>&#125;&#125;</span><br><span class="line">(gdb) p  *s.tab._type</span><br><span class="line">$<span class="number">27</span> = &#123;<span class="variable">size =</span> <span class="number">8</span>, <span class="variable">ptrdata =</span> <span class="number">0</span>, <span class="variable">hash =</span> <span class="number">1148337467</span>, <span class="variable">_unused =</span> <span class="number">0</span> '\<span class="number">000</span>', <span class="variable">align =</span> <span class="number">8</span> '\b', <span class="variable">fieldalign =</span> <span class="number">8</span> '\b', <span class="variable">kind =</span> <span class="number">139</span> '\<span class="number">213</span>', <span class="variable">alg =</span> <span class="number">0</span>x5926d0 &lt;runtime.algarray+<span class="number">80</span>&gt;,</span><br><span class="line">  <span class="variable">gcdata =</span> <span class="number">0</span>x537140 <span class="string">"\001\002\003\004\005\006\a\b\t\n\r\016\017\020\021\022\025\026\031\032\033\037,568&gt;?Ur\236\237\325\365\377"</span>, <span class="variable">_string =</span> <span class="number">0</span>x5161c0, <span class="variable">x =</span> <span class="number">0</span>x4e4ac8, <span class="variable">ptrto =</span> <span class="number">0</span>x4e4d20,</span><br><span class="line">  <span class="variable">zero =</span> <span class="number">0</span>x539c40 &lt;runtime.zerovalue&gt; <span class="string">""</span>&#125;</span><br><span class="line">(gdb) p  *s.tab.inter.typ._string</span><br><span class="line">$<span class="number">28</span> = <span class="number">0</span>x50b930 <span class="string">"main.Stringer"</span></span><br><span class="line">(gdb) p  *s.tab._type._string</span><br><span class="line">$<span class="number">29</span> = <span class="number">0</span>x50b920 <span class="string">"main.Binary"</span></span><br></pre></td></tr></table></figure></p>
<p>可以清晰的看出，itab的type是interface所包含值的type信息：<strong>main.Binary</strong>，而tab的interface type为该interface的类型信息: <strong>main.Stringer</strong>。<br>他们的size是不一样的。Binary的size为8个字节，而interface是16个字节。<br><strong>想想为啥interface是16个字节的大小？这里可以大胆猜测16个字节是系统内存管理的对齐对齐最小字节数，即libc之前的内存管理里面分配内存都是以16字节作为对齐的，这样也是为了方便内存管理吧。</strong><br>要想搞清楚tab里面所有变量的意义，那是不可能的了，在GDB调试过程中，发现中间穿插大量的汇编代码，特别是runtime库实现interface计算过程中。<br>继续，s的data也是个指针可以直接将其值打印出来：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="tag">p</span> *<span class="function"><span class="title">uint64</span><span class="params">(s.data)</span></span></span><br><span class="line">$<span class="number">22</span> = <span class="number">200</span></span><br></pre></td></tr></table></figure></p>
<p>因为我们事先知道该值类型为64位的uint型。<br>接着看下any和nothing这两个变量。该两个变量有着不同的类型。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p nothing</span><br><span class="line"><span class="variable">$51</span> = &#123;_<span class="built_in">type</span> = <span class="number">0</span>x4c1360, data = <span class="number">0</span>xc82000a430&#125;</span><br><span class="line">(gdb) p any</span><br><span class="line"><span class="variable">$52</span> = &#123;_<span class="built_in">type</span> = <span class="number">0</span>x4e4a80, data = <span class="number">0</span>xc82000a3c0&#125;</span><br></pre></td></tr></table></figure></p>
<p>针对interface go的编译器有两种的内存优化策略，就像上面两个变量，他们就不再有itab了，只是type，原因是他们没有方法集。上面文章中说的第二种优化策略，在实际测试中并没有验证出来，即如果interface里面的data值是32位的，则该data字段会直接存该值，不会用指针多一层引用了，即代码中的s32。</p>
<p>通过上面可以看出interface是runtime的产物，是go运行时的对象。这个很像C++中的虚函数表的行为。<br>从而也可以意识到interface是类型和接口同时兼备的，任何变量都可以赋值给interface，如果该变量是没有接口方法的话，那么interface就是只存其类型信息，否则如果有接口方法，就会多一个itab出来，里面会有其对应的函数列表。<br><strong>这样也就很容易理解，interface可以包容任何变量了，因为在运行时，interface变量会记录其所包含值的类型信息。</strong></p>
<h2 id="interface使用">interface使用</h2><p>关于interface的使用方面，有不少文章做了介绍，比如：<a href="http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go" target="_blank" rel="external"> How to use interfaces in Go</a>和<a href="https://golang.org/doc/effective_go.html#interfaces" target="_blank" rel="external">Effective Go</a>。<br>从上面部分可以了解到，interface是一种运行时类型，既有函数集还有数据。interface本身定义只能定义方法集，你所要做的就是把这些方法赋予某个Object上面。这样Object就有了这个interface的能力，任意使用这个interface作为参数或者值的地方，Object也就可以畅通无阻了。<br>interface可以接纳任意类型，因interface内部的type信息是完备的：用type switch 可以获取interface内部value的类型信息，如下所示。<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stringer <span class="interface"><span class="keyword">interface</span> </span>&#123;</span><br><span class="line">    <span class="built_in">String</span>() <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> value <span class="interface"><span class="keyword">interface</span></span>&#123;&#125; <span class="comment">// Value provided by caller.</span></span><br><span class="line"><span class="keyword">switch</span> str := value.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="built_in">string</span>:</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"><span class="keyword">case</span> Stringer:</span><br><span class="line">    <span class="keyword">return</span> str.String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>interface 更为抽象化的接口，通过interface来定义你的行为方法，行为方法里面会对对象数据产生变化，这个也是需要进行隔离的。跟与C++编码那种面向对象的思想有点出入，看起来不是那么直观。面向对象即先定义对象，和对象的行为。Go里面也是可以定义自己的对象和方法，然后再把这些方法抽象成一个类型：interface，interface就可以使用在函数接口当中，其实此时传递的时候还是你所定义的对象。</p>
<p>总体上感觉interface比面向对象更抽象了一层，需要在更多的实际开发过程中慢慢体会。</p>
<p>附：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">     <span class="string">"fmt"</span></span><br><span class="line">     <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">    String() <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> ToString(any <span class="keyword">interface</span>&#123;&#125;) <span class="typename">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> v, ok := any.(Stringer); ok &#123;</span><br><span class="line">        <span class="keyword">return</span> v.String()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> v := any.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="typename">int</span>:</span><br><span class="line">        <span class="keyword">return</span> strconv.Itoa(v)</span><br><span class="line">    <span class="keyword">case</span> <span class="typename">float32</span>:</span><br><span class="line">        <span class="keyword">return</span> strconv.FormatFloat(<span class="typename">float64</span>(v), <span class="string">'g'</span>, -<span class="number">1</span>, <span class="number">32</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"???"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Binary <span class="typename">uint64</span></span><br><span class="line"><span class="keyword">type</span> Binary32 <span class="typename">uint32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (i Binary) String() <span class="typename">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> strconv.FormatUint(i.Get(), <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (i Binary) Get() <span class="typename">uint64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="typename">uint64</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (i Binary32) String() <span class="typename">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> strconv.FormatUint(<span class="typename">uint64</span>(i.Get()), <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (i Binary32) Get() <span class="typename">uint64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="typename">uint64</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">    </span><br><span class="line">     b := Binary(<span class="number">200</span>)</span><br><span class="line">     b32 := Binary32(<span class="number">200</span>)</span><br><span class="line">    </span><br><span class="line">     s := Stringer(b)</span><br><span class="line">     s32 := Stringer(b32)</span><br><span class="line">    </span><br><span class="line">     any := (<span class="keyword">interface</span>&#123;&#125;)(b)</span><br><span class="line">    </span><br><span class="line">     fmt.Println(s.String())</span><br><span class="line">     fmt.Println(s32.String())</span><br><span class="line">    </span><br><span class="line">     fmt.Println(ToString(any))</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">var</span> nothing <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">     nothing = <span class="typename">uint64</span>(<span class="number">200</span>)</span><br><span class="line">     fmt.Println(nothing)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> face Stringer</span><br><span class="line">    </span><br><span class="line">     fmt.Println(face)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Go/"> #Go </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/09/30/前端经验/">
                前端经验
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-09-30
        </span>

        

        
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>最近还是比较忙，blog好久没有写了，当然也不排除自己有点懈怠。也没有什么太多要写的，就是些工作上的事情。最近做前端比较多，还是就写写前端的一些经验吧。之前也说过，前端就是一个积累的过程，另外多借鉴一些成熟的前端框架会对自己的水平提高很有帮助。</p>
<h1 id="CSS相关">CSS相关</h1><p>因为开发是基于LESS的，所以代码相关的都是<a href="http://less.bootcss.com/" target="_blank" rel="external">LESS</a>的代码。</p>
<h2 id="mixin">mixin</h2><p>可以看作是面向对象的CSS，直白的讲就是混合引入，也有翻译是混入或混合，这样感觉都是很模糊的。其实功能上就是定义一组属性、style在一个mixin中，可以让其他的class直接引用，作为公共的基础class。例如：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.ellipsis</span> (<span class="variable">@width</span>) &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="variable">@width</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个ellipsis class会将定宽文本进行截断，这样的class可能会在网站中多处使用，而且每次使用宽度可变，这样在使用时传入想要宽度的参数即可。例如产品名字的class：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">product-name</span> &#123;</span><br><span class="line">     <span class="class">.ellipsis</span>(<span class="number">8em</span>);</span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="media">media</h2><p>由于前端一直在使用<a href="http://v3.bootcss.com/css/" target="_blank" rel="external">bootstrap</a>，所以所有的responsive相关的design都是依赖bootstrap来实现。bootstrap的栅格系统需要一定的使用规则，有的时候过度使用会导致DOM结构过去复杂化了。例如其中的form，form里面必须按照一个input一个label的排列，如果想要添加一些文本信息或者增加其他的标签，又让他保持responsive，必须通过类似row下的col再嵌套row和col，这样就实现很复杂，让DOM结构看起来混乱不堪。<br>其实看看bootstrap.css里面的代码也不难发现，其实responsive的代码也不难写，问题是你不需要去写一个框架，框架的代码是普适的。你只是为了满足一个小特性，所以代码也会写的很精简。</p>
<p>使用<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media" target="_blank" rel="external">media query</a> 来索引屏幕尺寸并进行特定class的apply。可以让网页支持较好的自适应性。例如针对小屏幕某个class需要有些自适应的属性，下面这个css class在小屏幕上，屏幕宽度小于767px时，左侧增加20px的margin。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.class-name</span> &#123;</span><br><span class="line">     <span class="at_rule">@media</span>(<span class="attribute">max-width</span>: <span class="number">767px</span>) &#123;</span><br><span class="line">          <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">          ...</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面是在class里面进行屏幕适应，更多的时候是定义整个class为自适应：<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@media <span class="keyword">only</span> screen and (<span class="built_in">max</span>-width: 67px) &#123;</span><br><span class="line">     .<span class="keyword">class</span>-<span class="keyword">name</span> &#123;</span><br><span class="line">          ...</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据不同的尺寸class里面的style进行相应的变化。bootstrap也是这么玩的。<br>在移动设备上有横屏和竖屏的区分，也能做相应的自适应。<br>关键的属性：</p>
<table>
<thead>
<tr>
<th>media 属性</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>min-width</td>
<td style="text-align:center">当任意浏览器宽度大于查询中定义的值时适用的规则。</td>
</tr>
<tr>
<td>max-width</td>
<td style="text-align:center">当任意浏览器宽度小于查询中定义的值时适用的规则。</td>
</tr>
<tr>
<td>min-height</td>
<td style="text-align:center">当任意浏览器高度大于查询中定义的值时适用的规则。</td>
</tr>
<tr>
<td>max-height</td>
<td style="text-align:center">当任意浏览器高度小于查询中定义的值时适用的规则。</td>
</tr>
<tr>
<td>orientation=portrait</td>
<td style="text-align:center">高度大于或等于宽度的任意浏览器适用的规则。相当于竖屏。</td>
</tr>
<tr>
<td>orientation=landscape</td>
<td style="text-align:center">宽度大于高度的任意浏览器适用的规则。相当于横屏。</td>
</tr>
</tbody>
</table>
<h2 id="语义化标签">语义化标签</h2><p>写一些复杂网页的时候，DOM元素的选取至关重要。要尽量结合Object的属性，进行语义上的对应选择，多使用语义化的标签。例如一个product detail页面，product属性是非常复杂的，有多个variant，variant下面有多个value。当选择variant和对应的value 的时候，就能确定一个单品，这时还会有多个事件的处理，例如每个单品的价格、库存都是变化的，产品的variant对应有相应的产品图片。<br>这样的DOM结构，全部使用div能做出来吗，肯定能做出来，但是复杂度就上去了。因为要兼顾前端UI的展示、JS的交互等等。通过观察多个电商网站的DOM结构，也能发现，大部分是使用：dl dt dd + ul li。即外层展示使用dl dt，dd里面套上ul + li 展示具体的variant value，这样的DOM结构清晰，CSS class的selector也很容易写，包括JS的也是一样的。</p>
<p>上面只是简单举个实际过程中遇到的例子。其实语义化标签的使用包含很多其他的东西；随着经验的积累使用起来也会更加得心应手。</p>
<h1 id="JS相关">JS相关</h1><p>JS遵从语言规范外，对单个页面使用的JS进行封装，让代码看起来不是太过去杂乱。如果前端的JS使用了框架应该不存在这样的问题。<br>封装的时候要对照页面的DOM结构和交互流程，让Object能更好为事件响应服务。</p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/WEB/"> #WEB </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/08/05/So-Busy/">
                So Busy
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-08-05
        </span>

        

        
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>最近几周，有点回到华为的感觉了，没想到在大外企也有这么紧张的时候，但主要是部门管理完全掌握在国人手里。<br>整理下最近都是忙了点啥。<br>由于产品定位是个电商平台，那么前端theme的开发其实变得不是那么的重要了，重要的是后台能力的构建。也就是提供足够强大、灵活的接口供前端消费，这个重构的过程就是要满足这个定位了。<br>这其中有个恶心的地方就是本来平台开发是基于wordpress的，而wordpress本身是个开箱即用的东西，完全不是MVC的框架。但需要提供的接口要满足REST Ful 的。所以很多url 的route 规则需要自己去实现。这样下来发现如果最早使用一个PHP的MVC框架会省不小心啊。<br>好在这个过程需要研究下PHP的MVC框架，为后续的演进做好了铺垫。<br>另外一个项目就是需要开发自己的CMS系统，这个系统以OPEN API为基础。框架采用后端Java Spring， 前端使用angularJS。<br>由于对java确是使用的较少，什么java框架也没玩过，所以就聚焦在了angularJS上了。angularJS是前端的MVC框架，能力出众。值得深入研究使用。最起码javaScripts方面的知识派上用场了。</p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Work/"> #Work </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/18/php-framework/">
                PHP 框架之CodeIgniter & Laravel
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-07-18
        </span>

        

        
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h1 id="说明">说明</h1><p>最近产品考虑更换前端框架，重点考察了CodeIgniter 和 Laravel两个框架，现对其进行下对比分析。</p>
<h1 id="总体对比">总体对比</h1><table>
<thead>
<tr>
<th></th>
<th style="text-align:left">CodeIgniter</th>
<th style="text-align:center">Laravel</th>
</tr>
</thead>
<tbody>
<tr>
<td>Document</td>
<td style="text-align:left">Good enough</td>
<td style="text-align:center">Good enough</td>
</tr>
<tr>
<td>Performance</td>
<td style="text-align:left">差不多 3倍于 Laravel</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>MVC</td>
<td style="text-align:left">Good enough</td>
<td style="text-align:center">Good enough</td>
</tr>
<tr>
<td>TWIG</td>
<td style="text-align:left">自己添加 TWIG lib</td>
<td style="text-align:center">使用三方插件</td>
</tr>
<tr>
<td>third-party</td>
<td style="text-align:left">自己添加，放到指定目录</td>
<td style="text-align:center">composer managment</td>
</tr>
<tr>
<td>Route</td>
<td style="text-align:left">default mapping ：”example.com/class/function/id/“ can be remap, more code than Laravel</td>
<td style="text-align:center">Simple and clear</td>
</tr>
<tr>
<td>summary</td>
<td style="text-align:left">简单 精巧</td>
<td style="text-align:center">易用，更为丰满</td>
</tr>
</tbody>
</table>
<p>CodeIgniter 基本上是个MVC的空架子，代码量极小，开发的花基本上 100%的掌控在自己手里。 Laravel还是加载了不少的三方 component，比CodeIgniter 庞大些。<br>对MVC的支持都很清晰，URL的路由也很简单易扩展。</p>
<h1 id="测试环境：">测试环境：</h1><p>主要是使用了Laravel 的HomeStead环境，通过virtual box + vagrant标准用法，加载Laravel的框架代码；要使其加载CodeIgniter框架，需要修改Nginx的配置，增加新的server，只要端口号换成新的，root指定到CodeIgniter的跟目录即可。<br>总体上是Nginx+php5-fpm+mysql+ Ubuntu + CodeIgniter 源码包 + Laravel 源码包。源码包共享在本机上。</p>
<h1 id="测试页面：">测试页面：</h1><p>Modal：使用product数据，获取某个product上的所有信息。<br>View：引入Twig模板引擎，创建几个twig模板，在controller层render。<br>Controller：调用modal获取数据，使用 twig render 页面。</p>
<p>这两个框架都用非常清晰的 MVC结构，上述页面的代码几乎可以在两者之间无缝迁移。</p>
<h1 id="性能对比测试：">性能对比测试：</h1><p>针对这个页面进行性能测试：页面大小为 8KB， 加载一个已有的CSS文件大小为 87.7KB。<br>使用Apache的ab test进行测试：<br>AB test:<br>ab -n 1000 -c 80 <a href="http://192.168.10.10:8080/productdetail/" target="_blank" rel="external">http://192.168.10.10:8080/productdetail/</a></p>
<h2 id="Laravel_结果:">Laravel 结果:</h2><p>Server Software:        nginx/1.8.0<br>Server Hostname:        192.168.10.10<br>Server Port:            80</p>
<p>Document Path:          /product/<br>Document Length:        200205 bytes</p>
<p>Concurrency Level:      80<br>Time taken for tests:   112.455 seconds<br>Complete requests:      1000<br>Failed requests:        0<br>Total transferred:      200793036 bytes<br>HTML transferred:       200205000 bytes<br>Requests per second:    8.89 [#/sec] (mean)<br>Time per request:       8996.416 [ms] (mean)<br>Time per request:       112.455 [ms] (mean, across all concurrent requests)<br>Transfer rate:          1743.69 [Kbytes/sec] received</p>
<p>Connection Times (ms)</p>
<p>min  mean[+/-sd] median   max<br>Connect:        0    1   1.0      0      18<br>Processing:  2001 8604 1574.3   8488   17271<br>Waiting:     1999 8594 1572.4   8480   17269<br>Total:       2005 8604 1574.0   8490   17271<br>WARNING: The median and mean for the initial connection time are not within a normal deviation</p>
<p>These results are probably not that reliable.</p>
<p>Percentage of the requests served within a certain time (ms)</p>
<p>  50%   8490</p>
<p>  66%   8695</p>
<p>  75%   8960</p>
<p>  80%   9098</p>
<p>  90%   9951</p>
<p>  95%  12074</p>
<p>  98%  12548</p>
<p>  99%  12944</p>
<p> 100%  17271 (longest request)</p>
<h2 id="CodeIgniter_结果:">CodeIgniter 结果:</h2><p>Server Software:        nginx/1.8.0<br>Server Hostname:        192.168.10.10<br>Server Port:            8080</p>
<p>Document Path:          /productdetail/<br>Document Length:        200205 bytes</p>
<p>Concurrency Level:      80<br>Time taken for tests:   40.332 seconds<br>Complete requests:      1000<br>Failed requests:        0<br>Total transferred:      200341000 bytes<br>HTML transferred:       200205000 bytes<br>Requests per second:    24.79 [#/sec] (mean)<br>Time per request:       3226.569 [ms] (mean)<br>Time per request:       40.332 [ms] (mean, across all concurrent requests)<br>Transfer rate:          4850.86 [Kbytes/sec] received</p>
<p>Connection Times (ms)</p>
<p>min  mean[+/-sd] median   max<br>Connect:        0    1   1.3      0      23<br>Processing:   346 3097 456.3   3169    3649<br>Waiting:      343 3089 455.7   3161    3645<br>Total:        351 3098 455.5   3170    3649</p>
<p>Percentage of the requests served within a certain time (ms)</p>
<p>  50%   3170</p>
<p>  66%   3216</p>
<p>  75%   3250</p>
<p>  80%   3270</p>
<p>  90%   3326</p>
<p>  95%   3467</p>
<p>  98%   3551</p>
<p>  99%   3582</p>
<p> 100%   3649 (longest request)</p>
<h1 id="总结">总结</h1><p>CodeIgniter 更轻便，代码可以做到100%掌控；Laravel相比CodeIgniter更加丰满些，使用composer管理扩展性增强了不少。<br>如果选择从头开始的话，感觉CodeIgniter更好些。</p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PHP/"> #PHP </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/09/Go-Go/">
                Go Go
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-07-09
        </span>

        

        
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>最近在学习Go语言。认识Go语言是个偶然，首选是Docker容器的使用，Docker的兴起目前可谓风生水起，应用部署和各种云平台都在推行。其使用Go语言开发，之前没有听说过的。断断续续的找相关的博客、资料进行了解。发现Go 是有很多吸引人的地方，自己非常感兴趣，最近买的一本《Go Web编程》今天到手了。</p>
<p>也说下自己的缘由，很多人都说Go 很容易上手，这应该对C系的开发人员而说的，Go语言的发明者也是C语言的作者，Go语言本身很多的语法、类型、结构等用法类似于C语言，如果编译运行的话二进制文件都能用GDB进行调试。Go语言是个集大成者，在里面你能看到或者重新认识一些语言特性，它有诸多动态语言特有的特性。</p>
<ol>
<li>首选想说的就是函数闭包，闭包函数在JavaScript里面应用的最广泛，用于各种回调处理、变量的scope控制等，在Go语言里面也有，使用起来几乎没有什么差别，也能当成变量传递等等。</li>
<li>内置强大的数据结构，例如slice、map，开发的快捷易用性可以和Python媲美。slice 类似于Python、PHP里面的array，map也和Python里面的字典。</li>
<li>interface的类型使用，interface让Go有了面向对象的能力，interface是非常有魔力的东西，应该会是非常广泛的，把面向对象的能力放大了。Go里面的反射功能也是依赖于interface，这篇文章<a href="http://research.swtch.com/interfaces" target="_blank" rel="external">Go Data Structures: Interfaces</a>有较深入的讲解。</li>
<li>并发编程的支持，可以写并发执行的代码，通过go关键字来完成。goroutine确是是个好东西，用户层上的并发协程，能有效的利用多核计算能力。Go能原生的支持并发编程并能很好的利用多核能力是个极大的优势。</li>
</ol>
<p>有人说不能把Go作为偏向Web的语言，这应该是比较片面的。就像Python一样，一直都是当成工具使用，能快速的开发一些小工具，而现在呢，Python的Web框架为Python的流行应该是起了主要作用。Go的使用应该要偏向云平台开发、Web开发，高性能、高并发的场景。试想下Docker的流行，国内七牛公司对Go语言的推崇。</p>
<p>Go相对于PHP、JAVA年轻很多，但自己相信它会成为后起之秀，也做好了这个准备。</p>
<p>很高兴开启Go语言之旅。</p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Programming-Go/"> #Programming, Go </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  
  <div class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Jet He" />
          <p class="site-author-name">Jet He</p>
        </div>
        <p class="site-description motion-element">杂乱 并蓄</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/Compasses" target="_blank">GitHub</a>
            </span>
            
          
        </div>

        
        

      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Jet He</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.content img').each(function () {
        var $image = $(this);
        var $imageWrapLink = $image.parent('a');

        if ($imageWrapLink.size() < 1) {
          $imageWrapLink = $image.wrap('<a href="' + this.getAttribute('src') + '"></a>').parent('a');
        }
        $imageWrapLink.addClass('fancybox');
      });
    });
    $('.fancybox').fancybox({
      helpers: {
        overlay: {
          locked: false
        }
      }
    });
  </script>


  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  

  

  
  
  

  




  
  
</body>
</html>
